<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
		<!-- jquery-loading v1.3.0 -->
		<link href="https://cdn.jsdelivr.net/npm/jquery-easy-loading@1.3.0/dist/jquery.loading.min.css" rel="stylesheet" />
		<script src="https://cdn.jsdelivr.net/npm/jquery-easy-loading@1.3.0/dist/jquery.loading.min.js"></script>
		<title>台灣空氣品質查詢系統</title>
	</head>
	<body>
		<h1 align="center">台灣空氣品質查詢系統</h1>
		<p align="center">
			<select id = "County">
			</select>
		</p>
		<table align="center" border = '1' id = "AQI_detail">
			
		</table>
	</body>
	<footer style = "background-color:black">
		<p align="center" style="font-size:40%; color:white" >作者:陳柏銓</p>
	</footer>
</html>


<script type="text/javascript">
	var County = new Array();
	var JsonData = new Object();
	
	$(document).ready(function(){
		$("body").loading(); //loading開始
		
		var requestURL = 'https://cors-anywhere.herokuapp.com/opendata.epa.gov.tw/ws/Data/AQI/?$format=json';
		//var requestURL = 'opendata.epa.gov.tw/ws/Data/AQI/?$format=json';		//CORS
		$.get(requestURL,function(response){
			if(response.status = 200){
				JsonData = response;
				$.each(response,function(index,value){
					if(County.indexOf(value.County) == -1)
					{
						County.push(value.County);
						$("#County").append(`<option value = "${value.County}">${value.County}</option>`);
					}
				});
			}
			
			$("body").loading("stop") //loading停止
		});
	});
	
	$("#County").blur(function(){
		$("#AQI_detail tr").remove();	//移除原搜尋資料
		
		$.each(JsonData,function(index,value){
			//console.log(this.County.toString());
			//console.log($("#County :selected").text());
			//console.log(this.County.toString() == $("#County :selected").text());
			if(this.County.toString() == $("#County :selected").text()){
				console.log(this);
				$("#AQI_detail").append(`<tr><td>觀測站:${value.SiteName}</br>
												AQI:${value.AQI}
										</td>
										</tr>`);
			}
		});
	});
</script>